2012-09-12  Niibe Yutaka  <gniibe@fsij.org>

	* boards/STBEE/board.h (GPIOD_USB_ENABLE): Fix.

2012-09-11  Niibe Yutaka  <gniibe@fsij.org>

	Health tests (SP 800-90b).
	* src/random.c (repetition_count_test)
	(adaptive_proportion_64_test, adaptive_proportion_4096_test): New.

2012-09-10  Niibe Yutaka  <gniibe@fsij.org>

	* NEUG_USB_DEVICE_ID: New file.

	* src/main.c: Include usb-vid-pid-ver.c.inc and usb-strings.c.inc.

	* src/configure (vidpid): New.

2012-08-30  Niibe Yutaka  <gniibe@fsij.org>

	* Version 0.02.

2012-08-27  Niibe Yutaka  <gniibe@fsij.org>

	Use WELL random number generator to whiten noise input.
	* src/random.c (NUM_NOISE_INPUTS): Now, it's 6.
	(tmt_init, tmt_one_step, tmt_value): Remove.
	(well512a_step): New function.  WELL random number generator.
	(neug_prng_reseed): Remove.

	* src/main.c (main): Call neug_flash with time interval 2500ms,
	while disconnected.
	Don't call neug_prng_reseed.
	More blinks.

	* src/neug.h (NEUG_PRE_LOOP): It's 64 now (was: 32).

2012-08-13  Niibe Yutaka  <gniibe@fsij.org>

	* src/main.c (RANDOM_BYTES_LENGTH): It's now 60 (was: 32).
	(neug_device_reset, neug_ctrl_write_finish)
	(vcom_port_data_setup, neug_setup, neug_get_descriptor)
	(neug_setup_endpoints_for_interface, neug_usb_event)
	(neug_interface, Vector90, EP1_IN_Callback, EP2_IN_Callback)
	(EP3_OUT_Callback): New.
	(main): Now use usb_lld_* functions (was: ChibiOS SDU driver).

	* boards/*/board.c (USB_Cable_Config, set_led): Remove.
	, boards/*/board.h (SET_USB_CONDITION, SET_LED_CONDITION)
	(GPIO_USB, IOPORT_USB, GPIO_LED, IOPORT_LED): Define.

	* boards/common/board-common.c [DFU_SUPPORT] (__early_init): Don't
	set SCB->VTOR here (it's done in reset in src/sys.c).

	* src/halconf.h (HAL_USE_SERIAL_USB, HAL_USE_USB): Not define.
	* src/Makefile.in (CSRC): Add sys.c and usb_lld.c
	* src/sys.h, src/sys.c: New files (from Gnuk).
	* src/usb_lld.h, src/usb_lld.c: New files (from Gnuk).

2011-11-14  Niibe Yutaka  <gniibe@fsij.org>

	* Version 0.01.

	* src/Makefile.in (MCFLAGS): Override MCFLAGS option for newer
	GCC of summon-arm-toolchain to add -mfix-cortex-m3-ldrd.
	NOTE: This should not be needed (as -mcpu=cortex-m3 defaults
	to -mfix-cortex-m3-ldrd for GCC-proper), but it is needed
	to select arm-none-eabi/lib/thumb2/libc.a correctly.

	* boards/common/board-common.c (__early_init): Revert change of
	2011-10-05.

	* boards/FST_01/{mcuconf.h,board.h,board.c}: New.

	* src/main.c (my_sduRequestsHook): New.
	(LED_ONESHOT_SHORT, LED_ONESHOT_LONG): New.
	(led_blinker): Support LED_ONESHOT_SHORT and LED_ONESHOT_LONG.
	(main): Call neug_prng_reseed for each new connection.

2011-10-07  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c (neug_wait_full): New (from Gnuk).

2011-10-06  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c (neug_flush): New.
	(neug_prng_reseed): Call neug_flush.

2011-10-05  NIIBE Yutaka  <gniibe@fsij.org>

	* boards/common/board-common.c (__early_init): Set MSP register
	in case of DFU.

2011-10-04  NIIBE Yutaka  <gniibe@fsij.org>

	* src/chconf.h (THREAD_CONTEXT_SWITCH_HOOK): New.

	* src/Makefile.in: Follow the change of ChibiOS 2.3.3 (new
	directory structure of platforms/STM32F1xx).

	* src/main.c (vcom_configuration_descriptor_data, usb_event):
	Follow the change of ChibiOS 2.3.3 (USB_CDC_*).
	(vcom_string3): Version 0.01.

	* src/configure (MEMORY_SIZE): New.

	* src/neug.ld.in (@MEMORY_SIZE@): New (for HD device like STBEE).
	(.stacks): New in newer ChibiOS (>= 2.3.3).

	* src/random.c (adccb_err): New.
	(adcgrpcfg): Add adccb_err.

	* chibios: Updated to trunk of 2.3.3.

2011-09-27  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c (adcgrpcfg): Fix configuration value (had old
	values by old example).

2011-09-22  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c 	(ROTATE): Remove.
	(SHIFT_RIGHT): New.
	(ep_add): Use SHIFT_RIGHT.

2011-09-21  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c (ep_output): Bug fix for second argument of
	fnv32_hash, and change the way to place values into the buffer.
	(ep_add): Feedback byte always shift 1-bit, entropy_bit sometimes.

2011-09-20  NIIBE Yutaka  <gniibe@fsij.org>

	* boards/STBEE/mcuconf.h, boards/STBEE/board.h: New.
	* boards/STBEE/board.c: New.
	* boards/common/board-common.c (pal_default_config): Add case for
	STM32F10X_HD.
	* src/configure: Support STBEE.

	* src/random.c (PROBABILITY_50_BY_TICK): New.
	(ep_add): Use ROTATE for final feedback only.
	(fnv32_hash): New.
	(ep_output): Rename (was: ep_value).  Use fnv32_hash.

2011-08-29  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c (ep_add): New argument another_random_bit.
	(crc32_top_bit, crc32_add_bit): Delete.
	(tmt_init): New.
	(rng_gen): Call ep_add with SysTick->VAL shake.
	Don't shake PRNG by interrupt timing.
	(neug_prng_reseed): New.

	* src/main.c (main): Call neug_prng_reseed after new connection.

	* src/neug.h (neug_prng_reseed): New.

2011-08-19  NIIBE Yutaka  <gniibe@fsij.org>

	* src/random.c (tmt_one_step): No argument.
	(crc32_top_bit, crc32_add_bit): New.
	(rng_gen): Have return value.  Put interrupt timing entropy
	to CRC32 shift register, and use the top bit of CRC32 to
	shake the steps of TMT.

2011-08-10  NIIBE Yutaka  <gniibe@fsij.org>

	* boards/STM8S_DISCOVERY/mcuconf.h: New.
	* boards/STM8S_DISCOVERY/board.h: New.
	* boards/STM8S_DISCOVERY/board.c: New.

2011-07-22  NIIBE Yutaka  <gniibe@fsij.org>

	* boards/OLIMEX_STM32_H103/mcuconf.h (STM32_USBPRE): Add.

	* src/main.c (main): Fix one shot logic.

2011-07-21  NIIBE Yutaka  <gniibe@fsij.org>

	* src/neug.h (NEUG_PRE_LOOP): New.

	* src/main.c (led_blinker): New.
	(main): Use led_blinker.
	(main): Call neug_get before USB configuration at least
	NEUG_PRE_LOOP times.

2011-07-14  NIIBE Yutaka  <gniibe@fsij.org>

	* src/configure: Support CQ_STARM.
	* boards/CQ_STARM: Added.

	* Version 0.00.

